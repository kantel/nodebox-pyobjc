
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>sympy.holonomic.holonomic &#8212; SymPy 1.1.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-core.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-autocomplete.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-sphinx.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/utilities.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/external/classy.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-core.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-autocomplete.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../_static/sympy-notailtext-favicon.ico"/>
    <link href="http://docs.sympy.org/latest/_modules/sympy/holonomic/holonomic.html" rel="canonical" />
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SymPy 1.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sympy.holonomic.holonomic</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module implements Holonomic Functions and</span>
<span class="sd">various operations on them.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="p">(</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Dummy</span><span class="p">,</span> <span class="n">Order</span><span class="p">,</span> <span class="n">rf</span><span class="p">,</span> <span class="n">meijerint</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span>
    <span class="n">solve</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">nsimplify</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sympy.printing</span> <span class="k">import</span> <span class="n">sstr</span>
<span class="kn">from</span> <span class="nn">sympy.core.compatibility</span> <span class="k">import</span> <span class="nb">range</span><span class="p">,</span> <span class="n">ordered</span>
<span class="kn">from</span> <span class="nn">sympy.functions.combinatorial.factorials</span> <span class="k">import</span> <span class="n">binomial</span><span class="p">,</span> <span class="n">factorial</span>
<span class="kn">from</span> <span class="nn">sympy.core.sympify</span> <span class="k">import</span> <span class="n">sympify</span>
<span class="kn">from</span> <span class="nn">sympy.simplify.hyperexpand</span> <span class="k">import</span> <span class="n">hyperexpand</span>
<span class="kn">from</span> <span class="nn">sympy.functions.special.hyper</span> <span class="k">import</span> <span class="n">hyper</span><span class="p">,</span> <span class="n">meijerg</span>
<span class="kn">from</span> <span class="nn">sympy.core.numbers</span> <span class="k">import</span> <span class="n">NaN</span><span class="p">,</span> <span class="n">Infinity</span><span class="p">,</span> <span class="n">NegativeInfinity</span>
<span class="kn">from</span> <span class="nn">sympy.matrices</span> <span class="k">import</span> <span class="n">Matrix</span>
<span class="kn">from</span> <span class="nn">sympy.functions.elementary.exponential</span> <span class="k">import</span> <span class="n">exp_polar</span><span class="p">,</span> <span class="n">exp</span>

<span class="kn">from</span> <span class="nn">.linearsolver</span> <span class="k">import</span> <span class="n">NewMatrix</span>
<span class="kn">from</span> <span class="nn">.recurrence</span> <span class="k">import</span> <span class="n">HolonomicSequence</span><span class="p">,</span> <span class="n">RecurrenceOperator</span><span class="p">,</span> <span class="n">RecurrenceOperators</span>
<span class="kn">from</span> <span class="nn">.holonomicerrors</span> <span class="k">import</span> <span class="p">(</span><span class="n">NotPowerSeriesError</span><span class="p">,</span> <span class="n">NotHyperSeriesError</span><span class="p">,</span>
    <span class="n">SingularityError</span><span class="p">,</span> <span class="n">NotHolonomicError</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sympy.polys.rings</span> <span class="k">import</span> <span class="n">PolyElement</span>
<span class="kn">from</span> <span class="nn">sympy.polys.fields</span> <span class="k">import</span> <span class="n">FracElement</span>
<span class="kn">from</span> <span class="nn">sympy.polys.domains</span> <span class="k">import</span> <span class="n">QQ</span><span class="p">,</span> <span class="n">ZZ</span><span class="p">,</span> <span class="n">RR</span>
<span class="kn">from</span> <span class="nn">sympy.polys.domains.pythonrational</span> <span class="k">import</span> <span class="n">PythonRational</span>
<span class="kn">from</span> <span class="nn">sympy.polys.polyclasses</span> <span class="k">import</span> <span class="n">DMF</span>
<span class="kn">from</span> <span class="nn">sympy.polys.polyroots</span> <span class="k">import</span> <span class="n">roots</span>


<span class="k">def</span> <span class="nf">DifferentialOperators</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is used to create annihilators using ``Dx``.</span>

<span class="sd">    Returns an Algebra of Differential Operators also called Weyl Algebra</span>
<span class="sd">    and the operator for differentiation i.e. the ``Dx`` operator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    base:</span>
<span class="sd">        Base polynomial ring for the algebra.</span>
<span class="sd">        The base polynomial ring is the ring of polynomials in :math:`x` that</span>
<span class="sd">        will appear as coefficients in the operators.</span>
<span class="sd">    generator:</span>
<span class="sd">        Generator of the algebra which can</span>
<span class="sd">        be either a noncommutative ``Symbol`` or a string. e.g. &quot;Dx&quot; or &quot;D&quot;.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.abc import x</span>
<span class="sd">    &gt;&gt;&gt; from sympy.holonomic.holonomic import DifferentialOperators</span>
<span class="sd">    &gt;&gt;&gt; R, Dx = DifferentialOperators(ZZ.old_poly_ring(x), &#39;Dx&#39;)</span>
<span class="sd">    &gt;&gt;&gt; R</span>
<span class="sd">    Univariate Differential Operator Algebra in intermediate Dx over the base ring ZZ[x]</span>
<span class="sd">    &gt;&gt;&gt; Dx*x</span>
<span class="sd">    (1) + (x)*Dx</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ring</span> <span class="o">=</span> <span class="n">DifferentialOperatorAlgebra</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">generator</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">ring</span><span class="o">.</span><span class="n">derivative_operator</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DifferentialOperatorAlgebra</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Ore Algebra is a set of noncommutative polynomials in the</span>
<span class="sd">    intermediate ``Dx`` and coefficients in a base polynomial ring :math:`A`.</span>
<span class="sd">    It follows the commutation rule:</span>
<span class="sd">    .. math ::</span>
<span class="sd">        Dxa = \sigma(a)Dx + \delta(a)</span>

<span class="sd">    for :math:`a \subset A`.</span>

<span class="sd">    Where :math:`\sigma: A --&gt; A` is an endomorphism and :math:`\delta: A --&gt; A`</span>
<span class="sd">    is a skew-derivation i.e. :math:`\delta(ab) = \delta(a) * b + \sigma(a) * \delta(b)`.</span>

<span class="sd">    If one takes the sigma as identity map and delta as the standard derivation</span>
<span class="sd">    then it becomes the algebra of Differential Operators also called</span>
<span class="sd">    a Weyl Algebra i.e. an algebra whose elements are Differential Operators.</span>

<span class="sd">    This class represents a Weyl Algebra and serves as the parent ring for</span>
<span class="sd">    Differential Operators.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">    &gt;&gt;&gt; from sympy.holonomic.holonomic import DifferentialOperators</span>
<span class="sd">    &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">    &gt;&gt;&gt; R, Dx = DifferentialOperators(ZZ.old_poly_ring(x), &#39;Dx&#39;)</span>
<span class="sd">    &gt;&gt;&gt; R</span>
<span class="sd">    Univariate Differential Operator Algebra in intermediate Dx over the base ring</span>
<span class="sd">    ZZ[x]</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    DifferentialOperator</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
        <span class="c1"># the base polynomial ring for the algebra</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">base</span>
        <span class="c1"># the operator representing differentiation i.e. `Dx`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derivative_operator</span> <span class="o">=</span> <span class="n">DifferentialOperator</span><span class="p">(</span>
            <span class="p">[</span><span class="n">base</span><span class="o">.</span><span class="n">zero</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">one</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">generator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gen_symbol</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;Dx&#39;</span><span class="p">,</span> <span class="n">commutative</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gen_symbol</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="n">commutative</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gen_symbol</span> <span class="o">=</span> <span class="n">generator</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;Univariate Differential Operator Algebra in intermediate &#39;</span>\
            <span class="o">+</span> <span class="n">sstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gen_symbol</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; over the base ring &#39;</span> <span class="o">+</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">string</span>

    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">base</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_symbol</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">gen_symbol</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>


<span class="k">class</span> <span class="nc">DifferentialOperator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Differential Operators are elements of Weyl Algebra. The Operators</span>
<span class="sd">    are defined by a list of polynomials in the base ring and the</span>
<span class="sd">    parent ring of the Operator i.e. the algebra it belongs to.</span>

<span class="sd">    Takes a list of polynomials for each power of ``Dx`` and the</span>
<span class="sd">    parent ring which must be an instance of DifferentialOperatorAlgebra.</span>

<span class="sd">    A Differential Operator can be created easily using</span>
<span class="sd">    the operator ``Dx``. See examples below.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.holonomic.holonomic import DifferentialOperator, DifferentialOperators</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ, QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">    &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">    &gt;&gt;&gt; R, Dx = DifferentialOperators(ZZ.old_poly_ring(x),&#39;Dx&#39;)</span>

<span class="sd">    &gt;&gt;&gt; DifferentialOperator([0, 1, x**2], R)</span>
<span class="sd">    (1)*Dx + (x**2)*Dx**2</span>

<span class="sd">    &gt;&gt;&gt; (x*Dx*x + 1 - Dx**2)**2</span>
<span class="sd">    (2*x**2 + 2*x + 1) + (4*x**3 + 2*x**2 - 4)*Dx + (x**4 - 6*x - 2)*Dx**2 + (-2*x**2)*Dx**3 + (1)*Dx**4</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    DifferentialOperatorAlgebra</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_op_priority</span> <span class="o">=</span> <span class="mi">20</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_poly</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        list_of_poly:</span>
<span class="sd">            List of polynomials belonging to the base ring of the algebra.</span>
<span class="sd">        parent:</span>
<span class="sd">            Parent algebra of the operator.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># the parent ring for this operator</span>
        <span class="c1"># must be an DifferentialOperatorAlgebra object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">gens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">gens</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Symbol</span><span class="p">)</span> <span class="k">else</span> <span class="n">base</span><span class="o">.</span><span class="n">gens</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># sequence of polynomials in x for each power of Dx</span>
        <span class="c1"># the list should not have trailing zeroes</span>
        <span class="c1"># represents the operator</span>
        <span class="c1"># convert the expressions into ring elements using from_sympy</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_poly</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
                <span class="n">list_of_poly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">from_sympy</span><span class="p">(</span><span class="n">sympify</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">list_of_poly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">from_sympy</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">listofpoly</span> <span class="o">=</span> <span class="n">list_of_poly</span>
        <span class="c1"># highest power of `Dx`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiplies two DifferentialOperator and returns another</span>
<span class="sd">        DifferentialOperator instance using the commutation rule</span>
<span class="sd">        Dx*a = a*Dx + a&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">listofself</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listofpoly</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DifferentialOperator</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
                <span class="n">listofother</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">from_sympy</span><span class="p">(</span><span class="n">sympify</span><span class="p">(</span><span class="n">other</span><span class="p">))]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">listofother</span> <span class="o">=</span> <span class="p">[</span><span class="n">other</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">listofother</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">listofpoly</span>

        <span class="c1"># multiplies a polynomial `b` with a list of polynomials</span>
        <span class="k">def</span> <span class="nf">_mul_dmp_diffop</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">listofother</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">listofother</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listofother</span><span class="p">:</span>
                    <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">sol</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">b</span> <span class="o">*</span> <span class="n">listofother</span><span class="p">]</span>

        <span class="n">sol</span> <span class="o">=</span> <span class="n">_mul_dmp_diffop</span><span class="p">(</span><span class="n">listofself</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">listofother</span><span class="p">)</span>

        <span class="c1"># compute Dx^i * b</span>
        <span class="k">def</span> <span class="nf">_mul_Dxi_b</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">sol1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">zero</span><span class="p">]</span>
            <span class="n">sol2</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
                    <span class="n">sol1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">sol2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">diff</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sol1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">from_sympy</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
                <span class="n">sol2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">from_sympy</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">_add_lists</span><span class="p">(</span><span class="n">sol1</span><span class="p">,</span> <span class="n">sol2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">listofself</span><span class="p">)):</span>
            <span class="c1"># find Dx^i * b in ith iteration</span>
            <span class="n">listofother</span> <span class="o">=</span> <span class="n">_mul_Dxi_b</span><span class="p">(</span><span class="n">listofother</span><span class="p">)</span>
            <span class="c1"># solution = solution + listofself[i] * (Dx^i * b)</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">_add_lists</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">_mul_dmp_diffop</span><span class="p">(</span><span class="n">listofself</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">listofother</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">DifferentialOperator</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DifferentialOperator</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
                <span class="n">other</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="p">)</span><span class="o">.</span><span class="n">from_sympy</span><span class="p">(</span><span class="n">sympify</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

            <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">:</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span> <span class="o">*</span> <span class="n">j</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">DifferentialOperator</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DifferentialOperator</span><span class="p">):</span>

            <span class="n">sol</span> <span class="o">=</span> <span class="n">_add_lists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">DifferentialOperator</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listofpoly</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
                <span class="n">list_other</span> <span class="o">=</span> <span class="p">[((</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">base</span><span class="p">)</span><span class="o">.</span><span class="n">from_sympy</span><span class="p">(</span><span class="n">sympify</span><span class="p">(</span><span class="n">other</span><span class="p">))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">list_other</span> <span class="o">=</span> <span class="p">[</span><span class="n">other</span><span class="p">]</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">list_other</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">sol</span> <span class="o">+=</span> <span class="n">list_self</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="k">return</span> <span class="n">DifferentialOperator</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

    <span class="fm">__radd__</span> <span class="o">=</span> <span class="fm">__add__</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">One</span> <span class="o">/</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DifferentialOperator</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">one</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

        <span class="c1"># if self is `Dx`</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">listofpoly</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">derivative_operator</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">:</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">zero</span><span class="p">)</span>
            <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">one</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">DifferentialOperator</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

        <span class="c1"># the general case</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">powreduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">**</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">powreduce</span> <span class="o">*</span> <span class="bp">self</span>
            <span class="k">elif</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">powreduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">**</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">powreduce</span> <span class="o">*</span> <span class="n">powreduce</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">listofpoly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listofpoly</span>
        <span class="n">print_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">listofpoly</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">zero</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">print_str</span> <span class="o">+=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">sstr</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">print_str</span><span class="p">:</span>
                <span class="n">print_str</span> <span class="o">+=</span> <span class="s1">&#39; + &#39;</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">print_str</span> <span class="o">+=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">sstr</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)*</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">gen_symbol</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">print_str</span> <span class="o">+=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">sstr</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span> <span class="o">+</span> <span class="s1">&#39;*</span><span class="si">%s</span><span class="s1">**&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">gen_symbol</span><span class="p">)</span> <span class="o">+</span> <span class="n">sstr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">print_str</span>

    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DifferentialOperator</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">listofpoly</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">listofpoly</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listofpoly</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">zero</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">is_singular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the differential equation is singular at x0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span>
        <span class="k">return</span> <span class="n">x0</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">HolonomicFunction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Holonomic Function is a solution to a linear homogeneous ordinary</span>
<span class="sd">    differential equation with polynomial coefficients. This differential</span>
<span class="sd">    equation can also be represented by an annihilator i.e. a Differential</span>
<span class="sd">    Operator ``L`` such that :math:`L.f = 0`. For uniqueness of these functions,</span>
<span class="sd">    initial conditions can also be provided along with the annihilator.</span>

<span class="sd">    Holonomic functions have closure properties and thus forms a ring.</span>
<span class="sd">    Given two Holonomic Functions f and g, their sum, product,</span>
<span class="sd">    integral and derivative is also a Holonomic Function.</span>

<span class="sd">    For ordinary points initial condition should be a vector of values of</span>
<span class="sd">    the derivatives i.e. :math:`[y(x_0), y&#39;(x_0), y&#39;&#39;(x_0) ... ]`.</span>

<span class="sd">    For regular singular points initial conditions can also be provided in this</span>
<span class="sd">    format:</span>
<span class="sd">    :math:`{s0: [C_0, C_1, ...], s1: [C^1_0, C^1_1, ...], ...}`</span>
<span class="sd">    where s0, s1, ... are the roots of indicial equation and vectors</span>
<span class="sd">    :math:`[C_0, C_1, ...], [C^0_0, C^0_1, ...], ...` are the corresponding intial</span>
<span class="sd">    terms of the associated power series. See Examples below.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.holonomic.holonomic import HolonomicFunction, DifferentialOperators</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ, QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy import symbols, S</span>
<span class="sd">    &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">    &gt;&gt;&gt; R, Dx = DifferentialOperators(QQ.old_poly_ring(x),&#39;Dx&#39;)</span>

<span class="sd">    &gt;&gt;&gt; p = HolonomicFunction(Dx - 1, x, 0, [1])  # e^x</span>
<span class="sd">    &gt;&gt;&gt; q = HolonomicFunction(Dx**2 + 1, x, 0, [0, 1])  # sin(x)</span>

<span class="sd">    &gt;&gt;&gt; p + q  # annihilator of e^x + sin(x)</span>
<span class="sd">    HolonomicFunction((-1) + (1)*Dx + (-1)*Dx**2 + (1)*Dx**3, x, 0, [1, 2, 1])</span>

<span class="sd">    &gt;&gt;&gt; p * q  # annihilator of e^x * sin(x)</span>
<span class="sd">    HolonomicFunction((2) + (-2)*Dx + (1)*Dx**2, x, 0, [0, 1])</span>

<span class="sd">    An example of initial conditions for regular singular points,</span>
<span class="sd">    the indicial equation has only one root `1/2`.</span>

<span class="sd">    &gt;&gt;&gt; HolonomicFunction(-S(1)/2 + x*Dx, x, 0, {S(1)/2: [1]})</span>
<span class="sd">    HolonomicFunction((-1/2) + (x)*Dx, x, 0, {1/2: [1]})</span>

<span class="sd">    &gt;&gt;&gt; HolonomicFunction(-S(1)/2 + x*Dx, x, 0, {S(1)/2: [1]}).to_expr()</span>
<span class="sd">    sqrt(x)</span>

<span class="sd">    To plot a Holonomic Function, one can use `.evalf()` for numerical</span>
<span class="sd">    computation. Here&#39;s an example on `sin(x)**2/x` using numpy and matplotlib.</span>

<span class="sd">    &gt;&gt;&gt; import sympy.holonomic # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; from sympy import var, sin # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; var(&quot;x&quot;) # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; r = np.linspace(1, 5, 100) # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; y = sympy.holonomic.expr_to_holonomic(sin(x)**2/x, x0=1).evalf(r) # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; plt.plot(r, y, label=&quot;holonomic function&quot;) # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; plt.show() # doctest: +SKIP</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_op_priority</span> <span class="o">=</span> <span class="mi">20</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annihilator</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        annihilator:</span>
<span class="sd">            Annihilator of the Holonomic Function, represented by a</span>
<span class="sd">            `DifferentialOperator` object.</span>
<span class="sd">        x:</span>
<span class="sd">            Variable of the function.</span>
<span class="sd">        x0:</span>
<span class="sd">            The point at which initial conditions are stored.</span>
<span class="sd">            Generally an integer.</span>
<span class="sd">        y0:</span>
<span class="sd">            The initial condition. The proper format for the initial condition</span>
<span class="sd">            is described in class docstring. To make the function unique,</span>
<span class="sd">            length of the vector `y0` should be equal to or greater than the</span>
<span class="sd">            order of differential equation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initial condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span>
        <span class="c1"># the point for initial conditions, defualt is zero.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span>
        <span class="c1"># differential operator L such that L.f = 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span> <span class="o">=</span> <span class="n">annihilator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">():</span>
            <span class="n">str_sol</span> <span class="o">=</span> <span class="s1">&#39;HolonomicFunction(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="p">),</span>\
                <span class="n">sstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">sstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">),</span> <span class="n">sstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">str_sol</span> <span class="o">=</span> <span class="s1">&#39;HolonomicFunction(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="p">),</span>\
                <span class="n">sstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">str_sol</span>

    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span>

    <span class="k">def</span> <span class="nf">unify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unifies the base polynomial ring of a given two Holonomic</span>
<span class="sd">        Functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">R1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span>
        <span class="n">R2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span>

        <span class="n">dom1</span> <span class="o">=</span> <span class="n">R1</span><span class="o">.</span><span class="n">dom</span>
        <span class="n">dom2</span> <span class="o">=</span> <span class="n">R2</span><span class="o">.</span><span class="n">dom</span>

        <span class="k">if</span> <span class="n">R1</span> <span class="o">==</span> <span class="n">R2</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

        <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="n">dom1</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">dom2</span><span class="p">))</span><span class="o">.</span><span class="n">old_poly_ring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="n">newparent</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">DifferentialOperators</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">gen_symbol</span><span class="p">))</span>

        <span class="n">sol1</span> <span class="o">=</span> <span class="p">[</span><span class="n">R1</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">]</span>
        <span class="n">sol2</span> <span class="o">=</span> <span class="p">[</span><span class="n">R2</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">]</span>

        <span class="n">sol1</span> <span class="o">=</span> <span class="n">DifferentialOperator</span><span class="p">(</span><span class="n">sol1</span><span class="p">,</span> <span class="n">newparent</span><span class="p">)</span>
        <span class="n">sol2</span> <span class="o">=</span> <span class="n">DifferentialOperator</span><span class="p">(</span><span class="n">sol2</span><span class="p">,</span> <span class="n">newparent</span><span class="p">)</span>

        <span class="n">sol1</span> <span class="o">=</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span>
        <span class="n">sol2</span> <span class="o">=</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol2</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">sol1</span><span class="p">,</span> <span class="n">sol2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_singularics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if the function have singular initial condition</span>
<span class="sd">        in the dictionary format.</span>

<span class="sd">        Returns False if the function have ordinary initial condition</span>
<span class="sd">        in the list format.</span>

<span class="sd">        Returns None for all other cases.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_have_init_cond</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the function have initial condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_singularics_to_ord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a singular initial condition to ordinary if possible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
                <span class="n">y0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">y0</span> <span class="o">+=</span> <span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b</span><span class="p">)]</span>

            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># if the ground domains are different</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

        <span class="n">deg1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">order</span>
        <span class="n">deg2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">order</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">deg1</span><span class="p">,</span> <span class="n">deg2</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">get_field</span><span class="p">()</span>

        <span class="n">rowsself</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="p">]</span>
        <span class="n">rowsother</span> <span class="o">=</span> <span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">annihilator</span><span class="p">]</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">derivative_operator</span>

        <span class="c1"># constructing annihilators up to order dim</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span> <span class="o">-</span> <span class="n">deg1</span><span class="p">):</span>
            <span class="n">diff1</span> <span class="o">=</span> <span class="p">(</span><span class="n">gen</span> <span class="o">*</span> <span class="n">rowsself</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rowsself</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span> <span class="o">-</span> <span class="n">deg2</span><span class="p">):</span>
            <span class="n">diff2</span> <span class="o">=</span> <span class="p">(</span><span class="n">gen</span> <span class="o">*</span> <span class="n">rowsother</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rowsother</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff2</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="n">rowsself</span> <span class="o">+</span> <span class="n">rowsother</span>

        <span class="c1"># constructing the matrix of the ansatz</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">):</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">rep</span><span class="p">))</span>
            <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">NewMatrix</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="n">homosys</span> <span class="o">=</span> <span class="p">[[</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]]</span>
        <span class="n">homosys</span> <span class="o">=</span> <span class="n">NewMatrix</span><span class="p">(</span><span class="n">homosys</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="c1"># solving the linear system using gauss jordan solver</span>
        <span class="n">solcomp</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">gauss_jordan_solve</span><span class="p">(</span><span class="n">homosys</span><span class="p">)</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">solcomp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># if a solution is not obtained then increasing the order by 1 in each</span>
        <span class="c1"># iteration</span>
        <span class="k">while</span> <span class="n">sol</span><span class="o">.</span><span class="n">is_zero</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">diff1</span> <span class="o">=</span> <span class="p">(</span><span class="n">gen</span> <span class="o">*</span> <span class="n">rowsself</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rowsself</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff1</span><span class="p">)</span>

            <span class="n">diff2</span> <span class="o">=</span> <span class="p">(</span><span class="n">gen</span> <span class="o">*</span> <span class="n">rowsother</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rowsother</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff2</span><span class="p">)</span>

            <span class="n">row</span> <span class="o">=</span> <span class="n">rowsself</span> <span class="o">+</span> <span class="n">rowsother</span>
            <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">):</span>
                        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>

                        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">rep</span><span class="p">))</span>
                <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

            <span class="n">r</span> <span class="o">=</span> <span class="n">NewMatrix</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

            <span class="n">homosys</span> <span class="o">=</span> <span class="p">[[</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]]</span>
            <span class="n">homosys</span> <span class="o">=</span> <span class="n">NewMatrix</span><span class="p">(</span><span class="n">homosys</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

            <span class="n">solcomp</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">gauss_jordan_solve</span><span class="p">(</span><span class="n">homosys</span><span class="p">)</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">solcomp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># taking only the coefficients needed to multiply with `self`</span>
        <span class="c1"># can be also be done the other way by taking R.H.S and multiplying with</span>
        <span class="c1"># `other`</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[:</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">deg1</span><span class="p">]</span>
        <span class="n">sol1</span> <span class="o">=</span> <span class="n">_normalize</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="c1"># annihilator of the solution</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">sol1</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="p">)</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">_normalize</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">()</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">()):</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># both the functions have ordinary initial conditions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1"># directly add the corresponding value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">x0</span><span class="p">:</span>
                <span class="c1"># try to extended the initial conditions</span>
                <span class="c1"># using the annihilator</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="n">_extend_y0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">_extend_y0</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
                <span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]</span>
                <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># change the intiial conditions to a same point</span>
                <span class="n">selfat0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">otherat0</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">selfat0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">otherat0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">change_ics</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">x0</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">selfat0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">otherat0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_ics</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">other</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">selfatx0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span>
                    <span class="n">otheratx0</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">selfatx0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">otheratx0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">change_ics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_ics</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span> <span class="o">+</span> <span class="n">other</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">x0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># if the functions have singular_ics</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># convert the ordinary initial condition to singular.</span>
            <span class="n">_y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">)]</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="p">{</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">_y0</span><span class="p">}</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">y0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">_y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">y0</span><span class="p">)]</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="p">{</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">_y0</span><span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">y0</span>

        <span class="c1"># computing singular initial condition for the result</span>
        <span class="c1"># taking union of the series terms of both functions</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y1</span><span class="p">:</span>
            <span class="c1"># add corresponding initial terms if the power</span>
            <span class="c1"># on `x` is same</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y2</span><span class="p">:</span>
                <span class="n">y0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y2</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y2</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y1</span><span class="p">:</span>
                <span class="n">y0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

<div class="viewcode-block" id="HolonomicFunction.integrate"><a class="viewcode-back" href="../../../modules/holonomic/operations.html#sympy.holonomic.holonomic.HolonomicFunction.integrate">[docs]</a>    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Integrates the given holonomic function.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.holonomic.holonomic import HolonomicFunction, DifferentialOperators</span>
<span class="sd">        &gt;&gt;&gt; from sympy.polys.domains import ZZ, QQ</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; R, Dx = DifferentialOperators(QQ.old_poly_ring(x),&#39;Dx&#39;)</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx - 1, x, 0, [1]).integrate((x, 0, x))  # e^x - 1</span>
<span class="sd">        HolonomicFunction((-1)*Dx + (1)*Dx**2, x, 0, [0, 1])</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx**2 + 1, x, 0, [1, 0]).integrate((x, 0, x))</span>
<span class="sd">        HolonomicFunction((1)*Dx + (1)*Dx**3, x, 0, [0, 1, 0])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># to get the annihilator, just multiply by Dx from right</span>
        <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">derivative_operator</span>

        <span class="c1"># if the function have initial conditions of the series format</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_singularics_to_ord</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="n">initcond</span><span class="p">)</span>

            <span class="c1"># computing singular initial condition for the function</span>
            <span class="c1"># produced after integration.</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">c2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">c2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

                    <span class="c1"># if power on `x` is -1, the integration becomes log(x)</span>
                    <span class="c1"># TODO: Implement this case</span>
                    <span class="k">elif</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;logarithmic terms in the series are not supported&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">c2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">S</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">y0</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">c2</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Definite integration for singular initial conditions&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span> <span class="o">*</span> <span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

        <span class="c1"># if no initial conditions are available for the function</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">initcond</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span> <span class="o">*</span> <span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)])</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span> <span class="o">*</span> <span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># definite integral</span>
        <span class="c1"># initial conditions for the answer will be stored at point `a`,</span>
        <span class="c1"># where `a` is the lower limit of the integrand</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">):</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">definite</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">definite</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
        <span class="n">y0</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>

        <span class="n">indefinite_integral</span> <span class="o">=</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span> <span class="o">*</span> <span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">definite</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">indefinite_integral</span>

        <span class="c1"># use evalf to get the values at `a`</span>
        <span class="k">if</span> <span class="n">x0</span> <span class="o">!=</span> <span class="n">a</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">indefinite_expr</span> <span class="o">=</span> <span class="n">indefinite_integral</span><span class="o">.</span><span class="n">to_expr</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">NotHyperSeriesError</span><span class="p">,</span> <span class="n">NotPowerSeriesError</span><span class="p">):</span>
                <span class="n">indefinite_expr</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">indefinite_expr</span><span class="p">:</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="n">indefinite_expr</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">NaN</span><span class="p">):</span>
                    <span class="n">lower</span> <span class="o">=</span> <span class="n">indefinite_expr</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="n">indefinite_integral</span><span class="o">.</span><span class="n">evalf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                <span class="n">y0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lower</span>
                <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span> <span class="o">*</span> <span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">S</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">is_Number</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">indefinite_expr</span><span class="p">:</span>
                    <span class="n">upper</span> <span class="o">=</span> <span class="n">indefinite_expr</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">upper</span><span class="p">,</span> <span class="n">NaN</span><span class="p">):</span>
                        <span class="n">upper</span> <span class="o">=</span> <span class="n">indefinite_expr</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">upper</span> <span class="o">=</span> <span class="n">indefinite_integral</span><span class="o">.</span><span class="n">evalf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span>


        <span class="c1"># if the upper limit is `x`, the answer will be a function</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span> <span class="o">*</span> <span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

        <span class="c1"># if the upper limits is a Number, a numerical value will be returned</span>
        <span class="k">elif</span> <span class="n">S</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">is_Number</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span> <span class="o">*</span> <span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span>\
                    <span class="n">y0</span><span class="p">)</span><span class="o">.</span><span class="n">to_expr</span><span class="p">()</span>
                <span class="n">indefinite</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indefinite</span><span class="p">,</span> <span class="n">NaN</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">indefinite</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">NotHyperSeriesError</span><span class="p">,</span> <span class="n">NotPowerSeriesError</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span> <span class="o">*</span> <span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span><span class="o">.</span><span class="n">evalf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span> <span class="o">*</span> <span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="HolonomicFunction.diff"><a class="viewcode-back" href="../../../modules/holonomic/operations.html#sympy.holonomic.holonomic.HolonomicFunction.diff">[docs]</a>    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Differentiation of the given Holonomic function.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.holonomic.holonomic import HolonomicFunction, DifferentialOperators</span>
<span class="sd">        &gt;&gt;&gt; from sympy.polys.domains import ZZ, QQ</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; R, Dx = DifferentialOperators(ZZ.old_poly_ring(x),&#39;Dx&#39;)</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx**2 + 1, x, 0, [0, 1]).diff().to_expr()</span>
<span class="sd">        cos(x)</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx - 2, x, 0, [1]).diff().to_expr()</span>
<span class="sd">        2*exp(2*x)</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>

<span class="sd">        .integrate()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">sol</span>

        <span class="n">ann</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">derivative_operator</span>

        <span class="c1"># if the function is constant.</span>
        <span class="k">if</span> <span class="n">ann</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ann</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">zero</span> <span class="ow">and</span> <span class="n">ann</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># if the coefficient of y in the differential equation is zero.</span>
        <span class="c1"># a shifting is done to compute the answer in this case.</span>
        <span class="k">elif</span> <span class="n">ann</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ann</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">zero</span><span class="p">:</span>

            <span class="n">sol</span> <span class="o">=</span> <span class="n">DifferentialOperator</span><span class="p">(</span><span class="n">ann</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">ann</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">():</span>
                <span class="c1"># if ordinary initial condition</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="c1"># TODO: support for singular initial condition</span>
                <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># the general algorithm</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">get_field</span><span class="p">()</span>

        <span class="n">seq_dmf</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rep</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ann</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">]</span>

        <span class="c1"># -y = a1*y&#39;/a0 + a2*y&#39;&#39;/a0 ... + an*y^n/a0</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">/</span> <span class="n">seq_dmf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">seq_dmf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="n">rhs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">)</span>

        <span class="c1"># differentiate both lhs and rhs</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">_derivate_diff_eq</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>

        <span class="c1"># add the term y&#39; in lhs to rhs</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">_add_lists</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">])</span>

        <span class="n">sol</span> <span class="o">=</span> <span class="n">_normalize</span><span class="p">(</span><span class="n">sol</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="n">y0</span> <span class="o">=</span> <span class="n">_extend_y0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">annihilator</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">()</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">():</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">x0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">y0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">ann_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">HolonomicFunction</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">is_constant</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot; Can&#39;t multiply a HolonomicFunction and expressions/functions.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y0</span> <span class="o">=</span> <span class="n">_extend_y0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ann_self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">y0</span><span class="p">:</span>
                    <span class="n">y1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">ann_self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unify</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

        <span class="n">ann_other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">annihilator</span>

        <span class="n">list_self</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list_other</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ann_self</span><span class="o">.</span><span class="n">order</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">ann_other</span><span class="o">.</span><span class="n">order</span>

        <span class="n">R</span> <span class="o">=</span> <span class="n">ann_self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">get_field</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ann_self</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">:</span>
            <span class="n">list_self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">rep</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ann_other</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">:</span>
            <span class="n">list_other</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">rep</span><span class="p">))</span>

        <span class="c1"># will be used to reduce the degree</span>
        <span class="n">self_red</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">list_self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">list_self</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>

        <span class="n">other_red</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">list_other</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">list_other</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">)]</span>

        <span class="c1"># coeff_mull[i][j] is the coefficient of Dx^i(f).Dx^j(g)</span>
        <span class="n">coeff_mul</span> <span class="o">=</span> <span class="p">[[</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">coeff_mul</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># making the ansatz</span>
        <span class="n">lin_sys</span> <span class="o">=</span> <span class="p">[[</span><span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">)]]</span>

        <span class="n">homo_sys</span> <span class="o">=</span> <span class="p">[[</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)]]</span>
        <span class="n">homo_sys</span> <span class="o">=</span> <span class="n">NewMatrix</span><span class="p">(</span><span class="n">homo_sys</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="n">sol</span> <span class="o">=</span> <span class="p">(</span><span class="n">NewMatrix</span><span class="p">(</span><span class="n">lin_sys</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span><span class="o">.</span><span class="n">gauss_jordan_solve</span><span class="p">(</span><span class="n">homo_sys</span><span class="p">)</span>

        <span class="c1"># until a non trivial solution is found</span>
        <span class="k">while</span> <span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_zero</span><span class="p">:</span>

            <span class="c1"># updating the coefficents Dx^i(f).Dx^j(g) for next degree</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">K</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
                        <span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">DMFdiff</span><span class="p">(</span><span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

            <span class="c1"># reduce the terms to lower power using annihilators of f, g</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">==</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
                        <span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">other_red</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> \
                            <span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">b</span><span class="p">]</span>
                    <span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># not d2 + 1, as that is already covered in previous loop</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">coeff_mul</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
                        <span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">self_red</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> \
                            <span class="n">coeff_mul</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">coeff_mul</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">lin_sys</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">coeff_mul</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">)])</span>

            <span class="n">sol</span> <span class="o">=</span> <span class="p">(</span><span class="n">NewMatrix</span><span class="p">(</span><span class="n">lin_sys</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span><span class="o">.</span><span class="n">gauss_jordan_solve</span><span class="p">(</span><span class="n">homo_sys</span><span class="p">)</span>


        <span class="n">sol_ann</span> <span class="o">=</span> <span class="n">_normalize</span><span class="p">(</span><span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">()</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">()):</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol_ann</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1"># if both the conditions are at same point</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">x0</span><span class="p">:</span>

                <span class="c1"># try to find more inital conditions</span>
                <span class="n">y0_self</span> <span class="o">=</span> <span class="n">_extend_y0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sol_ann</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
                <span class="n">y0_other</span> <span class="o">=</span> <span class="n">_extend_y0</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">sol_ann</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
                <span class="c1"># h(x0) = f(x0) * g(x0)</span>
                <span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0_self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">y0_other</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

                <span class="c1"># coefficient of Dx^j(f)*Dx^i(g) in Dx^i(fg)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y0_self</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y0_other</span><span class="p">))):</span>
                    <span class="n">coeff</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">j</span> <span class="o">+</span> <span class="n">k</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                                <span class="n">coeff</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">binomial</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                    <span class="n">sol</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="n">sol</span> <span class="o">+=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">*</span> <span class="n">y0_self</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">y0_other</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                    <span class="n">y0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol_ann</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

            <span class="c1"># if the points are different, consider one</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="n">selfat0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">otherat0</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">selfat0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">otherat0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">change_ics</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">x0</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">selfat0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">otherat0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_ics</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">other</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">selfatx0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span>
                    <span class="n">otheratx0</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">selfatx0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">otheratx0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">change_ics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_ics</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="n">other</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">x0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol_ann</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># if the functions have singular_ics</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">_y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">)]</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="p">{</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">_y0</span><span class="p">}</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">y0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">_y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">y0</span><span class="p">)]</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="p">{</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">_y0</span><span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">y0</span>

        <span class="n">y0</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># multiply every possible pair of the series terms</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">y2</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y2</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">s</span> <span class="o">+=</span> <span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">*</span> <span class="n">y2</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">]</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">y0</span><span class="p">:</span>
                    <span class="n">y0</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">y0</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">y0</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">])]</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol_ann</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

    <span class="fm">__rmul__</span> <span class="o">=</span> <span class="fm">__mul__</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">One</span> <span class="o">/</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotHolonomicError</span><span class="p">(</span><span class="s2">&quot;Negative Power on a Holonomic Function&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">derivative_operator</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">Dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">powreduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">**</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">powreduce</span> <span class="o">*</span> <span class="bp">self</span>
            <span class="k">elif</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">powreduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">**</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">powreduce</span> <span class="o">*</span> <span class="n">powreduce</span>

    <span class="k">def</span> <span class="nf">degree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the highest power of `x` in the annihilator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>

<div class="viewcode-block" id="HolonomicFunction.composition"><a class="viewcode-back" href="../../../modules/holonomic/operations.html#sympy.holonomic.holonomic.HolonomicFunction.composition">[docs]</a>    <span class="k">def</span> <span class="nf">composition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns function after composition of a holonomic</span>
<span class="sd">        function with an algebraic function. The method can&#39;t compute</span>
<span class="sd">        initial conditions for the result by itself, so they can be also be</span>
<span class="sd">        provided.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.holonomic.holonomic import HolonomicFunction, DifferentialOperators</span>
<span class="sd">        &gt;&gt;&gt; from sympy.polys.domains import ZZ, QQ</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; R, Dx = DifferentialOperators(QQ.old_poly_ring(x),&#39;Dx&#39;)</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx - 1, x).composition(x**2, 0, [1])  # e^(x**2)</span>
<span class="sd">        HolonomicFunction((-2*x) + (1)*Dx, x, 0, [1])</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx**2 + 1, x).composition(x**2 - 1, 1, [1, 0])</span>
<span class="sd">        HolonomicFunction((4*x**3) + (-1)*Dx + (x)*Dx**2, x, 1, [1, 0])</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>

<span class="sd">        from_hyper()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">order</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">listofpoly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">listofpoly</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">listofpoly</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
                <span class="n">listofpoly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">listofpoly</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span><span class="n">expr</span><span class="p">})</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">listofpoly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span><span class="n">expr</span><span class="p">})</span> <span class="o">/</span> <span class="n">r</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">a</span><span class="p">)]</span>
        <span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>  <span class="c1"># coeffs[i] == coeff of (D^i f)(a) in D^k (f(a))</span>
        <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="p">[</span><span class="n">coeffs</span><span class="p">]</span>
        <span class="n">homogeneous</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([[</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">)]])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">sol</span><span class="o">.</span><span class="n">is_zero</span><span class="p">:</span>
            <span class="n">coeffs_next</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">coeffs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">coeffs_next</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">diff</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
                <span class="n">coeffs_next</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">subs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">diff</span><span class="p">)</span>
            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">coeffs_next</span>

            <span class="c1"># check for linear relations</span>
            <span class="n">system</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
            <span class="n">sol_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">Matrix</span><span class="p">(</span><span class="n">system</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span><span class="o">.</span><span class="n">gauss_jordan_solve</span><span class="p">(</span><span class="n">homogeneous</span><span class="p">)</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">sol_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="n">Dummy</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">_normalize</span><span class="p">(</span><span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">:],</span> <span class="n">R</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># if initial conditions are given for the resulting function</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="HolonomicFunction.to_sequence"><a class="viewcode-back" href="../../../modules/holonomic/operations.html#sympy.holonomic.holonomic.HolonomicFunction.to_sequence">[docs]</a>    <span class="k">def</span> <span class="nf">to_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds recurrence relation for the coefficients in the series expansion</span>
<span class="sd">        of the function about :math:`x_0`, where :math:`x_0` is the point at</span>
<span class="sd">        which the initial condition is stored.</span>

<span class="sd">        If the point :math:`x_0` is ordinary, solution of the form :math:`[(R, n_0)]`</span>
<span class="sd">        is returned. Where :math:`R` is the recurrence relation and :math:`n_0` is the</span>
<span class="sd">        smallest ``n`` for which the recurrence holds true.</span>

<span class="sd">        If the point :math:`x_0` is regular singular, a list of solutions in</span>
<span class="sd">        the format :math:`(R, p, n_0)` is returned, i.e. `[(R, p, n_0), ... ]`.</span>
<span class="sd">        Each tuple in this vector represents a recurrence relation :math:`R`</span>
<span class="sd">        associated with a root of the indicial equation ``p``. Conditions of</span>
<span class="sd">        a different format can also be provided in this case, see the</span>
<span class="sd">        docstring of HolonomicFunction class.</span>

<span class="sd">        If it&#39;s not possible to numerically compute a initial condition,</span>
<span class="sd">        it is returned as a symbol :math:`C_j`, denoting the coefficient of</span>
<span class="sd">        :math:`(x - x_0)^j` in the power series about :math:`x_0`.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.holonomic.holonomic import HolonomicFunction, DifferentialOperators</span>
<span class="sd">        &gt;&gt;&gt; from sympy.polys.domains import ZZ, QQ</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols, S</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; R, Dx = DifferentialOperators(QQ.old_poly_ring(x),&#39;Dx&#39;)</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx - 1, x, 0, [1]).to_sequence()</span>
<span class="sd">        [(HolonomicSequence((-1) + (n + 1)Sn, n), u(0) = 1, 0)]</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction((1 + x)*Dx**2 + Dx, x, 0, [0, 1]).to_sequence()</span>
<span class="sd">        [(HolonomicSequence((n**2) + (n**2 + n)Sn, n), u(0) = 0, u(1) = 1, u(2) = -1/2, 2)]</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(-S(1)/2 + x*Dx, x, 0, {S(1)/2: [1]}).to_sequence()</span>
<span class="sd">        [(HolonomicSequence((n), n), u(0) = 1, 1/2, 1)]</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>

<span class="sd">        HolonomicFunction.series()</span>

<span class="sd">        References</span>
<span class="sd">        ==========</span>

<span class="sd">        .. [1] https://hal.inria.fr/inria-00070025/document</span>
<span class="sd">        .. [2] http://www.risc.jku.at/publications/download/risc_2244/DIPLFORM.pdf</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">to_sequence</span><span class="p">()</span>

        <span class="c1"># check whether a power series exists if the point is singular</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frobenius</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="n">lb</span><span class="p">)</span>

        <span class="n">dict1</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">dom</span>
        <span class="n">R</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">RecurrenceOperators</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">old_poly_ring</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="s1">&#39;Sn&#39;</span><span class="p">)</span>

        <span class="c1"># substituting each term of the form `x^k Dx^j` in the</span>
        <span class="c1"># annihilator, according to the formula below:</span>
        <span class="c1"># x^k Dx^j = Sum(rf(n + 1 - k, j) * a(n + j - k) * x^n, (n, k, oo))</span>
        <span class="c1"># for explanation see [2].</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">):</span>

            <span class="n">listofdmp</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">all_coeffs</span><span class="p">()</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">listofdmp</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">coeff</span> <span class="o">=</span> <span class="n">listofdmp</span><span class="p">[</span><span class="n">degree</span> <span class="o">-</span> <span class="n">k</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">coeff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">:</span>
                    <span class="n">dict1</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span> <span class="o">*</span> <span class="n">rf</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dict1</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span> <span class="o">*</span> <span class="n">rf</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>


        <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">keylist</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">]</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">keylist</span><span class="p">)</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">keylist</span><span class="p">)</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>

        <span class="c1"># the recurrence relation holds for all values of</span>
        <span class="c1"># n greater than smallest_n, i.e. n &gt;= smallest_n</span>
        <span class="n">smallest_n</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">degree</span>
        <span class="n">dummys</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">eqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">unknowns</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># an appropriate shift of the recurrence</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">+=</span> <span class="n">dict1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">lower</span><span class="p">)</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

        <span class="c1"># the recurrence relation</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">RecurrenceOperator</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

        <span class="c1"># computing the initial conditions for recurrence</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span>
        <span class="n">all_roots</span> <span class="o">=</span> <span class="n">roots</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">n</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">all_roots</span> <span class="o">=</span> <span class="n">all_roots</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">all_roots</span><span class="p">:</span>
            <span class="n">max_root</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_roots</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">smallest_n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_root</span><span class="p">,</span> <span class="n">smallest_n</span><span class="p">)</span>
        <span class="n">order</span> <span class="o">+=</span> <span class="n">smallest_n</span>

        <span class="n">y0</span> <span class="o">=</span> <span class="n">_extend_y0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
        <span class="n">u0</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># u(n) = y^n(0)/factorial(n)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y0</span><span class="p">):</span>
            <span class="n">u0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="c1"># if sufficient conditions can&#39;t be computed then</span>
        <span class="c1"># try to use the series method i.e.</span>
        <span class="c1"># equate the coefficients of x^k in the equation formed by</span>
        <span class="c1"># substituting the series in differential equation, to zero.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">order</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">degree</span><span class="p">):</span>
                <span class="n">eq</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">dummys</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">):</span>
                        <span class="n">dummys</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">u0</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dummys</span><span class="p">:</span>
                        <span class="n">dummys</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;C_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="n">unknowns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummys</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

                    <span class="k">if</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">:</span>
                        <span class="n">eq</span> <span class="o">+=</span> <span class="n">dict1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">dummys</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

                <span class="n">eqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>

            <span class="c1"># solve the system of equations formed</span>
            <span class="n">soleqs</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">eqs</span><span class="p">,</span> <span class="o">*</span><span class="n">unknowns</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">soleqs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">),</span> <span class="n">order</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dummys</span><span class="p">:</span>
                        <span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;C_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">i</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">soleqs</span><span class="p">:</span>
                        <span class="n">u0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">soleqs</span><span class="p">[</span><span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">u0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">lb</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[(</span><span class="n">HolonomicSequence</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">u0</span><span class="p">),</span> <span class="n">smallest_n</span><span class="p">)]</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">HolonomicSequence</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">u0</span><span class="p">)]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">),</span> <span class="n">order</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dummys</span><span class="p">:</span>
                    <span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;C_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">i</span><span class="p">)</span>

                <span class="n">s</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">soleqs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                        <span class="n">u0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">u0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">lb</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">HolonomicSequence</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">u0</span><span class="p">),</span> <span class="n">smallest_n</span><span class="p">)]</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">HolonomicSequence</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">u0</span><span class="p">)]</span></div>

    <span class="k">def</span> <span class="nf">_frobenius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># compute the roots of indicial equation</span>
        <span class="n">indicialroots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indicial</span><span class="p">()</span>

        <span class="n">reals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">compl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ordered</span><span class="p">(</span><span class="n">indicialroots</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">is_real</span><span class="p">:</span>
                <span class="n">reals</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">indicialroots</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">as_real_imag</span><span class="p">()</span>
                <span class="n">compl</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)]</span> <span class="o">*</span> <span class="n">indicialroots</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># sort the roots for a fixed ordering of solution</span>
        <span class="n">compl</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">compl</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">reals</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="c1"># grouping the roots, roots differ by an integer are put in the same group.</span>
        <span class="n">grp</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reals</span><span class="p">:</span>
            <span class="n">intdiff</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">])</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">grp</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">intdiff</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">intdiff</span><span class="p">:</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># True if none of the roots differ by an integer i.e.</span>
        <span class="c1"># each element in group have only one member</span>
        <span class="n">independent</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">grp</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

        <span class="n">allpos</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reals</span><span class="p">)</span>
        <span class="n">allint</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reals</span><span class="p">)</span>

        <span class="c1"># if initial conditions are provided</span>
        <span class="c1"># then use them.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">rootstoconsider</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ordered</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ordered</span><span class="p">(</span><span class="n">indicialroots</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                        <span class="n">rootstoconsider</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">allpos</span> <span class="ow">and</span> <span class="n">allint</span><span class="p">:</span>
            <span class="n">rootstoconsider</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">reals</span><span class="p">)]</span>

        <span class="k">elif</span> <span class="n">independent</span><span class="p">:</span>
            <span class="n">rootstoconsider</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">grp</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">compl</span><span class="p">]</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">allint</span><span class="p">:</span>
            <span class="n">rootstoconsider</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reals</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">rootstoconsider</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">allpos</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">()</span> <span class="ow">or</span> <span class="n">S</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">is_finite</span> <span class="o">==</span>  <span class="kc">False</span><span class="p">:</span>
                <span class="n">rootstoconsider</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">reals</span><span class="p">)]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">posroots</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reals</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">posroots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">rootstoconsider</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">posroots</span><span class="p">)]</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">dom</span>
        <span class="n">R</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">RecurrenceOperators</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">old_poly_ring</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="s1">&#39;Sn&#39;</span><span class="p">)</span>

        <span class="n">finalsol</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">char</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">rootstoconsider</span><span class="p">:</span>
            <span class="n">dict1</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">):</span>

                <span class="n">listofdmp</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">all_coeffs</span><span class="p">()</span>
                <span class="n">degree</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">listofdmp</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">coeff</span> <span class="o">=</span> <span class="n">listofdmp</span><span class="p">[</span><span class="n">degree</span> <span class="o">-</span> <span class="n">k</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">coeff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">:</span>
                        <span class="n">dict1</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="n">i</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span> <span class="o">*</span> <span class="n">rf</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dict1</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span> <span class="o">*</span> <span class="n">rf</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

            <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">keylist</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">]</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">keylist</span><span class="p">)</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">keylist</span><span class="p">)</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">])</span>
            <span class="n">degree2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">])</span>

            <span class="n">smallest_n</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">degree</span>
            <span class="n">dummys</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">eqs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">unknowns</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                            <span class="n">temp</span> <span class="o">+=</span> <span class="n">dict1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">lower</span><span class="p">)</span>
                    <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

            <span class="c1"># the recurrence relation</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">RecurrenceOperator</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

            <span class="c1"># computing the initial conditions for recurrence</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span>
            <span class="n">all_roots</span> <span class="o">=</span> <span class="n">roots</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">n</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
            <span class="n">all_roots</span> <span class="o">=</span> <span class="n">all_roots</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">all_roots</span><span class="p">:</span>
                <span class="n">max_root</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_roots</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">smallest_n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_root</span><span class="p">,</span> <span class="n">smallest_n</span><span class="p">)</span>
            <span class="n">order</span> <span class="o">+=</span> <span class="n">smallest_n</span>

            <span class="n">u0</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">u0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="n">p</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rootstoconsider</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">y0</span> <span class="o">=</span> <span class="n">_extend_y0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
                <span class="c1"># u(n) = y^n(0)/factorial(n)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y0</span><span class="p">)):</span>
                        <span class="n">u0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">order</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">degree2</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span>
                    <span class="n">eq</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">dummys</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                        <span class="k">elif</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">):</span>
                            <span class="n">dummys</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">u0</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

                        <span class="k">elif</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dummys</span><span class="p">:</span>
                            <span class="n">letter</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">dummys</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>
                            <span class="n">unknowns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummys</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

                        <span class="k">if</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">:</span>
                            <span class="n">eq</span> <span class="o">+=</span> <span class="n">dict1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">dummys</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

                    <span class="n">eqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>

                <span class="c1"># solve the system of equations formed</span>
                <span class="n">soleqs</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">eqs</span><span class="p">,</span> <span class="o">*</span><span class="n">unknowns</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">soleqs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">),</span> <span class="n">order</span><span class="p">):</span>

                        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dummys</span><span class="p">:</span>
                            <span class="n">letter</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">i</span>
                            <span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">soleqs</span><span class="p">:</span>
                            <span class="n">u0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">soleqs</span><span class="p">[</span><span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">u0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">lb</span><span class="p">:</span>
                        <span class="n">finalsol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">HolonomicSequence</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">u0</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">smallest_n</span><span class="p">))</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">finalsol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">HolonomicSequence</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">u0</span><span class="p">),</span> <span class="n">p</span><span class="p">))</span>
                        <span class="k">continue</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">),</span> <span class="n">order</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dummys</span><span class="p">:</span>
                        <span class="n">letter</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">i</span>
                        <span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>

                    <span class="n">s</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">soleqs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                            <span class="n">u0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                            <span class="n">s</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
                        <span class="n">u0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">lb</span><span class="p">:</span>
                <span class="n">finalsol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">HolonomicSequence</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">u0</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">smallest_n</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">finalsol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">HolonomicSequence</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">u0</span><span class="p">),</span> <span class="n">p</span><span class="p">))</span>
            <span class="n">char</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">finalsol</span>

<div class="viewcode-block" id="HolonomicFunction.series"><a class="viewcode-back" href="../../../modules/holonomic/operations.html#sympy.holonomic.holonomic.HolonomicFunction.series">[docs]</a>    <span class="k">def</span> <span class="nf">series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">coefficient</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">_recur</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds the power series expansion of given holonomic function about :math:`x_0`.</span>

<span class="sd">        A list of series might be returned if :math:`x_0` is a regular point with</span>
<span class="sd">        multiple roots of the indicial equation.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.holonomic.holonomic import HolonomicFunction, DifferentialOperators</span>
<span class="sd">        &gt;&gt;&gt; from sympy.polys.domains import ZZ, QQ</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; R, Dx = DifferentialOperators(QQ.old_poly_ring(x),&#39;Dx&#39;)</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx - 1, x, 0, [1]).series()  # e^x</span>
<span class="sd">        1 + x + x**2/2 + x**3/6 + x**4/24 + x**5/120 + O(x**6)</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx**2 + 1, x, 0, [0, 1]).series(n=8)  # sin(x)</span>
<span class="sd">        x - x**3/6 + x**5/120 - x**7/5040 + O(x**8)</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>

<span class="sd">        HolonomicFunction.to_sequence()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">_recur</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">recurrence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_sequence</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recurrence</span> <span class="o">=</span> <span class="n">_recur</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">recurrence</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">recurrence</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">constantpower</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">recurrence</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">constantpower</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">recurrence</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">recurrence</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">constantpower</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">constantpower</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">recurrence</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">recurrence</span><span class="p">:</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">_recur</span><span class="o">=</span><span class="n">i</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">sol</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">constantpower</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="o">.</span><span class="n">u0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">recurrence</span><span class="o">.</span><span class="n">recurrence</span><span class="o">.</span><span class="n">order</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span>
        <span class="n">seq_dmp</span> <span class="o">=</span> <span class="n">recurrence</span><span class="o">.</span><span class="n">recurrence</span><span class="o">.</span><span class="n">listofpoly</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">recurrence</span><span class="o">.</span><span class="n">recurrence</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">get_field</span><span class="p">()</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seq_dmp</span><span class="p">):</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">rep</span><span class="p">))</span>

        <span class="n">sub</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">seq</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">recurrence</span><span class="o">.</span><span class="n">u0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># use the initial conditions to find the next term</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">):</span>
                <span class="n">coeff</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">coeff</span> <span class="o">+=</span> <span class="n">DMFsubs</span><span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">sol</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">coefficient</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sol</span>

        <span class="n">ser</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sol</span><span class="p">):</span>
            <span class="n">ser</span> <span class="o">+=</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">constantpower</span><span class="p">)</span> <span class="o">*</span> <span class="n">j</span>
        <span class="k">if</span> <span class="n">order</span><span class="p">:</span>
            <span class="n">ser</span> <span class="o">+=</span> <span class="n">Order</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">constantpower</span><span class="p">)),</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x0</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ser</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ser</span></div>

    <span class="k">def</span> <span class="nf">_indicial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes roots of the Indicial equation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">_indicial</span><span class="p">()</span>

        <span class="n">list_coeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">listofpoly</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">one</span>

        <span class="k">def</span> <span class="nf">_pole_degree</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
            <span class="n">root_all</span> <span class="o">=</span> <span class="n">roots</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">poly</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">root_all</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">root_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>

        <span class="n">degree</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">list_coeff</span><span class="p">]</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">degree</span><span class="p">)</span>
        <span class="n">inf</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">order</span><span class="p">))</span>

        <span class="n">deg</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="n">inf</span> <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">is_zero</span> <span class="k">else</span> <span class="n">_pole_degree</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">deg</span><span class="p">(</span><span class="n">list_coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_coeff</span><span class="p">)):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">deg</span><span class="p">(</span><span class="n">list_coeff</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_coeff</span><span class="p">):</span>
            <span class="n">listofdmp</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">all_coeffs</span><span class="p">()</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">listofdmp</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="n">b</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">degree</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="n">b</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">listofdmp</span><span class="p">[</span><span class="n">degree</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="n">b</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span>
            <span class="n">y</span> <span class="o">*=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">i</span>

        <span class="k">return</span> <span class="n">roots</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>

<div class="viewcode-block" id="HolonomicFunction.evalf"><a class="viewcode-back" href="../../../modules/holonomic/operations.html#sympy.holonomic.holonomic.HolonomicFunction.evalf">[docs]</a>    <span class="k">def</span> <span class="nf">evalf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;RK4&#39;</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">derivatives</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds numerical value of a holonomic function using numerical methods.</span>
<span class="sd">        (RK4 by default). A set of points (real or complex) must be provided</span>
<span class="sd">        which will be the path for the numerical integration.</span>

<span class="sd">        The path should be given as a list :math:`[x_1, x_2, ... x_n]`. The numerical</span>
<span class="sd">        values will be computed at each point in this order</span>
<span class="sd">        :math:`x_1 --&gt; x_2 --&gt; x_3 ... --&gt; x_n`.</span>

<span class="sd">        Returns values of the function at :math:`x_1, x_2, ... x_n` in a list.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.holonomic.holonomic import HolonomicFunction, DifferentialOperators</span>
<span class="sd">        &gt;&gt;&gt; from sympy.polys.domains import ZZ, QQ</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; R, Dx = DifferentialOperators(QQ.old_poly_ring(x),&#39;Dx&#39;)</span>

<span class="sd">        A straight line on the real axis from (0 to 1)</span>

<span class="sd">        &gt;&gt;&gt; r = [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1]</span>

<span class="sd">        Runge-Kutta 4th order on e^x from 0.1 to 1.</span>
<span class="sd">        Exact solution at 1 is 2.71828182845905</span>

<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx - 1, x, 0, [1]).evalf(r)</span>
<span class="sd">        [1.10517083333333, 1.22140257085069, 1.34985849706254, 1.49182424008069,</span>
<span class="sd">        1.64872063859684, 1.82211796209193, 2.01375162659678, 2.22553956329232,</span>
<span class="sd">        2.45960141378007, 2.71827974413517]</span>

<span class="sd">        Euler&#39;s method for the same</span>

<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx - 1, x, 0, [1]).evalf(r, method=&#39;Euler&#39;)</span>
<span class="sd">        [1.1, 1.21, 1.331, 1.4641, 1.61051, 1.771561, 1.9487171, 2.14358881,</span>
<span class="sd">        2.357947691, 2.5937424601]</span>

<span class="sd">        One can also observe that the value obtained using Runge-Kutta 4th order</span>
<span class="sd">        is much more accurate than Euler&#39;s method.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">sympy.holonomic.numerical</span> <span class="k">import</span> <span class="n">_evalf</span>
        <span class="n">lp</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># if a point `b` is given instead of a mesh</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">):</span>
            <span class="n">lp</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_evalf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">derivatives</span><span class="o">=</span><span class="n">derivatives</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="o">.</span><span class="n">is_Number</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span>

            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="o">-</span><span class="n">h</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span><span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">h</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SingularityError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lp</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_evalf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">derivatives</span><span class="o">=</span><span class="n">derivatives</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_evalf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">derivatives</span><span class="o">=</span><span class="n">derivatives</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">change_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes only the variable of Holonomic Function, for internal</span>
<span class="sd">        purposes. For composition use HolonomicFunction.composition()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">dom</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">dom</span><span class="o">.</span><span class="n">old_poly_ring</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">parent</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">DifferentialOperators</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="s1">&#39;Dx&#39;</span><span class="p">)</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">:</span>
            <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">rep</span><span class="p">))</span>
        <span class="n">sol</span> <span class="o">=</span>  <span class="n">DifferentialOperator</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">shift_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Substitute `x + a` for `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">listaftershift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">listofpoly</span>
        <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span>

        <span class="n">sol</span> <span class="o">=</span> <span class="p">[</span><span class="n">base</span><span class="o">.</span><span class="n">from_sympy</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listaftershift</span><span class="p">]</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">DifferentialOperator</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">-</span> <span class="n">a</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_init_cond</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span>

<div class="viewcode-block" id="HolonomicFunction.to_hyper"><a class="viewcode-back" href="../../../modules/holonomic/operations.html#sympy.holonomic.holonomic.HolonomicFunction.to_hyper">[docs]</a>    <span class="k">def</span> <span class="nf">to_hyper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_list</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">_recur</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a hypergeometric function (or linear combination of them)</span>
<span class="sd">        representing the given holonomic function.</span>

<span class="sd">        Returns an answer of the form:</span>
<span class="sd">        `a_1 \cdot x^{b_1} \cdot{hyper()} + a_2 \cdot x^{b_2} \cdot{hyper()} ...`</span>

<span class="sd">        This is very useful as one can now use ``hyperexpand`` to find the</span>
<span class="sd">        symbolic expressions/functions.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.holonomic.holonomic import HolonomicFunction, DifferentialOperators</span>
<span class="sd">        &gt;&gt;&gt; from sympy.polys.domains import ZZ, QQ</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; R, Dx = DifferentialOperators(ZZ.old_poly_ring(x),&#39;Dx&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # sin(x)</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx**2 + 1, x, 0, [0, 1]).to_hyper()</span>
<span class="sd">        x*hyper((), (3/2,), -x**2/4)</span>
<span class="sd">        &gt;&gt;&gt; # exp(x)</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(Dx - 1, x, 0, [1]).to_hyper()</span>
<span class="sd">        hyper((), (), x)</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>

<span class="sd">        from_hyper, from_meijerg</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">_recur</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">recurrence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_sequence</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recurrence</span> <span class="o">=</span> <span class="n">_recur</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">recurrence</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">smallest_n</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">recurrence</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">constantpower</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">recurrence</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">smallest_n</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">constantpower</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">recurrence</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">smallest_n</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">recurrence</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">constantpower</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">smallest_n</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">constantpower</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">recurrence</span> <span class="o">=</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_hyper</span><span class="p">(</span><span class="n">as_list</span><span class="o">=</span><span class="n">as_list</span><span class="p">,</span> <span class="n">_recur</span><span class="o">=</span><span class="n">recurrence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">recurrence</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">sol</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_hyper</span><span class="p">(</span><span class="n">as_list</span><span class="o">=</span><span class="n">as_list</span><span class="p">,</span> <span class="n">_recur</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sol</span>

        <span class="n">u0</span> <span class="o">=</span> <span class="n">recurrence</span><span class="o">.</span><span class="n">u0</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">recurrence</span><span class="o">.</span><span class="n">recurrence</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span>

        <span class="c1"># order of the recurrence relation</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">order</span>

        <span class="c1"># when no recurrence exists, and the power series have finite terms</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">nonzeroterms</span> <span class="o">=</span> <span class="n">roots</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">recurrence</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>

            <span class="n">sol</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nonzeroterms</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="n">i</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">PolyElement</span><span class="p">,</span> <span class="n">FracElement</span><span class="p">)):</span>
                        <span class="n">u0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">u0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
                    <span class="n">sol</span> <span class="o">+=</span> <span class="n">u0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">i</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">+=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;C_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">i</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="p">(</span><span class="n">PolyElement</span><span class="p">,</span> <span class="n">FracElement</span><span class="p">)):</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">constantpower</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="n">sol</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">constantpower</span>
            <span class="k">if</span> <span class="n">as_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x0</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[(</span><span class="n">sol</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">),</span> <span class="p">)]</span>
                <span class="k">return</span> <span class="p">[(</span><span class="n">sol</span><span class="p">,</span> <span class="p">)]</span>
            <span class="k">if</span> <span class="n">x0</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sol</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sol</span>

        <span class="k">if</span> <span class="n">smallest_n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t compute sufficient Initial Conditions&quot;</span><span class="p">)</span>

        <span class="c1"># check if the recurrence represents a hypergeometric series</span>
        <span class="n">is_hyper</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">r</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">zero</span><span class="p">:</span>
                <span class="n">is_hyper</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_hyper</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotHyperSeriesError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># the constant multiple of argument of hypergeometric function</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">rep</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">PolyElement</span><span class="p">,</span> <span class="n">FracElement</span><span class="p">)):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">rep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_expr</span><span class="p">())</span> <span class="o">*</span> <span class="n">m</span><span class="o">**</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">degree</span><span class="p">()))</span> <span class="o">/</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">rep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_expr</span><span class="p">())</span> <span class="o">*</span> <span class="n">m</span><span class="o">**</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">degree</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">rep</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">m</span><span class="o">**</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">degree</span><span class="p">()))</span> <span class="o">/</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">rep</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">m</span><span class="o">**</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">degree</span><span class="p">()))</span>

        <span class="n">sol</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">arg1</span> <span class="o">=</span> <span class="n">roots</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">recurrence</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="n">arg2</span> <span class="o">=</span> <span class="n">roots</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">recurrence</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

        <span class="c1"># iterate thorugh the initial conditions to find</span>
        <span class="c1"># the hypergeometric representation of the given</span>
        <span class="c1"># function.</span>
        <span class="c1"># The answer will be a linear combination</span>
        <span class="c1"># of different hypergeometric series which satisfies</span>
        <span class="c1"># the recurrence.</span>
        <span class="k">if</span> <span class="n">as_list</span><span class="p">:</span>
            <span class="n">listofsol</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">smallest_n</span> <span class="o">+</span> <span class="n">m</span><span class="p">):</span>

            <span class="c1"># if the recurrence relation doesn&#39;t hold for `n = i`,</span>
            <span class="c1"># then a Hypergeometric representation doesn&#39;t exist.</span>
            <span class="c1"># add the algebraic term a * x**i to the solution,</span>
            <span class="c1"># where a is u0[i]</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">smallest_n</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">as_list</span><span class="p">:</span>
                    <span class="n">listofsol</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">S</span><span class="p">(</span><span class="n">u0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">constantpower</span><span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">),</span> <span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">+=</span> <span class="n">S</span><span class="p">(</span><span class="n">u0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">i</span>
                <span class="k">continue</span>

            <span class="c1"># if the coefficient u0[i] is zero, then the</span>
            <span class="c1"># independent hypergeomtric series starting with</span>
            <span class="c1"># x**i is not a part of the answer.</span>
            <span class="k">if</span> <span class="n">S</span><span class="p">(</span><span class="n">u0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">ap</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">bq</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># substitute m * n + i for n</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ordered</span><span class="p">(</span><span class="n">arg1</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">ap</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">nsimplify</span><span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">m</span><span class="p">)]</span> <span class="o">*</span> <span class="n">arg1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ordered</span><span class="p">(</span><span class="n">arg2</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">bq</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">nsimplify</span><span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">m</span><span class="p">)]</span> <span class="o">*</span> <span class="n">arg2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

            <span class="c1"># convention of (k + 1) in the denominator</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">bq</span><span class="p">:</span>
                <span class="n">bq</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">as_list</span><span class="p">:</span>
                <span class="n">listofsol</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">S</span><span class="p">(</span><span class="n">u0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">constantpower</span><span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">),</span> <span class="p">(</span><span class="n">hyper</span><span class="p">(</span><span class="n">ap</span><span class="p">,</span> <span class="n">bq</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="n">m</span><span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sol</span> <span class="o">+=</span> <span class="n">S</span><span class="p">(</span><span class="n">u0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">hyper</span><span class="p">(</span><span class="n">ap</span><span class="p">,</span> <span class="n">bq</span><span class="p">,</span> <span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">i</span>
        <span class="k">if</span> <span class="n">as_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">listofsol</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">sol</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">constantpower</span>
        <span class="k">if</span> <span class="n">x0</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sol</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sol</span></div>

<div class="viewcode-block" id="HolonomicFunction.to_expr"><a class="viewcode-back" href="../../../modules/holonomic/operations.html#sympy.holonomic.holonomic.HolonomicFunction.to_expr">[docs]</a>    <span class="k">def</span> <span class="nf">to_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a Holonomic Function back to elementary functions.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.holonomic.holonomic import HolonomicFunction, DifferentialOperators</span>
<span class="sd">        &gt;&gt;&gt; from sympy.polys.domains import ZZ, QQ</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols, S</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; R, Dx = DifferentialOperators(ZZ.old_poly_ring(x),&#39;Dx&#39;)</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction(x**2*Dx**2 + x*Dx + (x**2 - 1), x, 0, [0, S(1)/2]).to_expr()</span>
<span class="sd">        besselj(1, x)</span>
<span class="sd">        &gt;&gt;&gt; HolonomicFunction((1 + x)*Dx**3 + Dx**2, x, 0, [1, 1, 1]).to_expr()</span>
<span class="sd">        x*log(x + 1) + log(x + 1) + 1</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">hyperexpand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_hyper</span><span class="p">())</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">change_ics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">lenics</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the point `x0` to `b` for initial conditions.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.holonomic import expr_to_holonomic</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols, sin, cos, exp</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>

<span class="sd">        &gt;&gt;&gt; expr_to_holonomic(sin(x)).change_ics(1)</span>
<span class="sd">        HolonomicFunction((1) + (1)*Dx**2, x, 1, [sin(1), cos(1)])</span>

<span class="sd">        &gt;&gt;&gt; expr_to_holonomic(exp(x)).change_ics(2)</span>
<span class="sd">        HolonomicFunction((-1) + (1)*Dx, x, 2, [exp(2)])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">symbolic</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">lenics</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">order</span><span class="p">:</span>
            <span class="n">lenics</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span>
        <span class="n">dom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">domain</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">expr_to_holonomic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_expr</span><span class="p">(),</span> <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">lenics</span><span class="o">=</span><span class="n">lenics</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">dom</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">NotPowerSeriesError</span><span class="p">,</span> <span class="n">NotHyperSeriesError</span><span class="p">):</span>
            <span class="n">symbolic</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">symbolic</span> <span class="ow">and</span> <span class="n">sol</span><span class="o">.</span><span class="n">x0</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sol</span>

        <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evalf</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">derivatives</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annihilator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

<div class="viewcode-block" id="HolonomicFunction.to_meijerg"><a class="viewcode-back" href="../../../modules/holonomic/operations.html#sympy.holonomic.holonomic.HolonomicFunction.to_meijerg">[docs]</a>    <span class="k">def</span> <span class="nf">to_meijerg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a linear combination of Meijer G-functions.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.holonomic import expr_to_holonomic</span>
<span class="sd">        &gt;&gt;&gt; from sympy import sin, cos, hyperexpand, log, symbols</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; hyperexpand(expr_to_holonomic(cos(x) + sin(x)).to_meijerg())</span>
<span class="sd">        sin(x) + cos(x)</span>
<span class="sd">        &gt;&gt;&gt; hyperexpand(expr_to_holonomic(log(x)).to_meijerg()).simplify()</span>
<span class="sd">        log(x)</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>

<span class="sd">        to_hyper()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># convert to hypergeometric first</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_hyper</span><span class="p">(</span><span class="n">as_list</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rep</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">sol</span> <span class="o">+=</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">sol</span> <span class="o">+=</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">_hyper_to_meijerg</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">sol</span></div>


<div class="viewcode-block" id="from_hyper"><a class="viewcode-back" href="../../../modules/holonomic/convert.html#sympy.holonomic.holonomic.from_hyper">[docs]</a><span class="k">def</span> <span class="nf">from_hyper</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">evalf</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a hypergeometric function to holonomic.</span>
<span class="sd">    ``func`` is the Hypergeometric Function and ``x0`` is the point at</span>
<span class="sd">    which initial conditions are required.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.holonomic.holonomic import from_hyper, DifferentialOperators</span>
<span class="sd">    &gt;&gt;&gt; from sympy import symbols, hyper, S</span>
<span class="sd">    &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">    &gt;&gt;&gt; from_hyper(hyper([], [S(3)/2], x**2/4))</span>
<span class="sd">    HolonomicFunction((-x) + (2)*Dx + (x)*Dx**2, x, 1, [sinh(1), -sinh(1) + cosh(1)])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">ap</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">bq</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="n">Symbol</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">R</span><span class="p">,</span> <span class="n">Dx</span> <span class="o">=</span> <span class="n">DifferentialOperators</span><span class="p">(</span><span class="n">QQ</span><span class="o">.</span><span class="n">old_poly_ring</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;Dx&#39;</span><span class="p">)</span>

    <span class="c1"># generalized hypergeometric differential equation</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">r1</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">Dx</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">Dx</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">Dx</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">r1</span> <span class="o">-</span> <span class="n">r2</span>

    <span class="n">simp</span> <span class="o">=</span> <span class="n">hyperexpand</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">Infinity</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">NegativeInfinity</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">composition</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_find_conditions</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">evalf</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">evalf</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">simp</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">simp</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
            <span class="c1"># return None if it is Infinite or NaN</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">is_finite</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">val</span><span class="o">.</span><span class="n">is_finite</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">NaN</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">y0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">simp</span> <span class="o">=</span> <span class="n">simp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y0</span>

    <span class="c1"># if the function is known symbolically</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">hyper</span><span class="p">):</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">y0</span><span class="p">:</span>
            <span class="c1"># if values don&#39;t exist at 0, then try to find initial</span>
            <span class="c1"># conditions at 1. If it doesn&#39;t exist at 1 too then</span>
            <span class="c1"># try 2 and so on.</span>
            <span class="n">x0</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">composition</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">hyper</span><span class="p">):</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># use evalf if the function can&#39;t be simpified</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="n">evalf</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">y0</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="n">evalf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">composition</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">composition</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></div>


<div class="viewcode-block" id="from_meijerg"><a class="viewcode-back" href="../../../modules/holonomic/convert.html#sympy.holonomic.holonomic.from_meijerg">[docs]</a><span class="k">def</span> <span class="nf">from_meijerg</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">evalf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">QQ</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Meijer G-function to Holonomic.</span>
<span class="sd">    ``func`` is the G-Function and ``x0`` is the point at</span>
<span class="sd">    which initial conditions are required.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.holonomic.holonomic import from_meijerg, DifferentialOperators</span>
<span class="sd">    &gt;&gt;&gt; from sympy import symbols, meijerg, S</span>
<span class="sd">    &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">    &gt;&gt;&gt; from_meijerg(meijerg(([], []), ([S(1)/2], [0]), x**2/4))</span>
<span class="sd">    HolonomicFunction((1) + (1)*Dx**2, x, 0, [0, 1/sqrt(pi)])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">ap</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">bq</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">an</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">bm</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="n">Symbol</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">R</span><span class="p">,</span> <span class="n">Dx</span> <span class="o">=</span> <span class="n">DifferentialOperators</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">old_poly_ring</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;Dx&#39;</span><span class="p">)</span>

    <span class="c1"># compute the differential equation satisfied by the</span>
    <span class="c1"># Meijer G-function.</span>
    <span class="n">mnp</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">mnp</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="n">r1</span> <span class="o">*=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">Dx</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
        <span class="n">r2</span> <span class="o">*=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">Dx</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">sol</span> <span class="o">=</span> <span class="n">r1</span> <span class="o">-</span> <span class="n">r2</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">initcond</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">composition</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="n">simp</span> <span class="o">=</span> <span class="n">hyperexpand</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">Infinity</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">NegativeInfinity</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">composition</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_find_conditions</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">evalf</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">evalf</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">simp</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">simp</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">is_finite</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">val</span><span class="o">.</span><span class="n">is_finite</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">NaN</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">y0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">simp</span> <span class="o">=</span> <span class="n">simp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y0</span>

    <span class="c1"># computing initial conditions</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">):</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">y0</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">composition</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">):</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="n">evalf</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">y0</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">simp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="n">evalf</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">composition</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">composition</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></div>


<span class="n">x_1</span> <span class="o">=</span> <span class="n">Dummy</span><span class="p">(</span><span class="s1">&#39;x_1&#39;</span><span class="p">)</span>
<span class="n">_lookup_table</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">domain_for_table</span> <span class="o">=</span> <span class="kc">None</span>
<span class="kn">from</span> <span class="nn">sympy.integrals.meijerint</span> <span class="k">import</span> <span class="n">_mytype</span>


<div class="viewcode-block" id="expr_to_holonomic"><a class="viewcode-back" href="../../../modules/holonomic/convert.html#sympy.holonomic.holonomic.expr_to_holonomic">[docs]</a><span class="k">def</span> <span class="nf">expr_to_holonomic</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lenics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a function or an expression to a holonomic function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    func:</span>
<span class="sd">        The expression to be converted.</span>
<span class="sd">    x:</span>
<span class="sd">        variable for the function.</span>
<span class="sd">    x0:</span>
<span class="sd">        point at which initial condition must be computed.</span>
<span class="sd">    y0:</span>
<span class="sd">        One can optionally provide initial condition if the method</span>
<span class="sd">        isn&#39;t able to do it automatically.</span>
<span class="sd">    lenics:</span>
<span class="sd">        Number of terms in the initial condition. By default it is</span>
<span class="sd">        equal to the order of the annihilator.</span>
<span class="sd">    domain:</span>
<span class="sd">        Ground domain for the polynomials in `x` appearing as coefficients</span>
<span class="sd">        in the annihilator.</span>
<span class="sd">    initcond:</span>
<span class="sd">        Set it false if you don&#39;t want the initial conditions to be computed.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.holonomic.holonomic import expr_to_holonomic</span>
<span class="sd">    &gt;&gt;&gt; from sympy import sin, exp, symbols</span>
<span class="sd">    &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">    &gt;&gt;&gt; expr_to_holonomic(sin(x))</span>
<span class="sd">    HolonomicFunction((1) + (1)*Dx**2, x, 0, [0, 1])</span>
<span class="sd">    &gt;&gt;&gt; expr_to_holonomic(exp(x))</span>
<span class="sd">    HolonomicFunction((-1) + (1)*Dx, x, 0, [1])</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    meijerint._rewrite1, _convert_poly_rat_alg, _create_table</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="n">syms</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">free_symbols</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">syms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x</span><span class="o">=</span> <span class="n">syms</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Specify the variable for the function&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">syms</span><span class="p">:</span>
        <span class="n">syms</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">extra_syms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">syms</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">domain</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">Float</span><span class="p">):</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">RR</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">QQ</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extra_syms</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="n">extra_syms</span><span class="p">]</span><span class="o">.</span><span class="n">get_field</span><span class="p">()</span>

    <span class="c1"># try to convert if the function is polynomial or rational</span>
    <span class="n">solpoly</span> <span class="o">=</span> <span class="n">_convert_poly_rat_alg</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span> <span class="n">lenics</span><span class="o">=</span><span class="n">lenics</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="n">initcond</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">solpoly</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">solpoly</span>

    <span class="c1"># create the lookup table</span>
    <span class="k">global</span> <span class="n">_lookup_table</span><span class="p">,</span> <span class="n">domain_for_table</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_lookup_table</span><span class="p">:</span>
        <span class="n">domain_for_table</span> <span class="o">=</span> <span class="n">domain</span>
        <span class="n">_lookup_table</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_create_table</span><span class="p">(</span><span class="n">_lookup_table</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">domain</span> <span class="o">!=</span> <span class="n">domain_for_table</span><span class="p">:</span>
        <span class="n">domain_for_table</span> <span class="o">=</span> <span class="n">domain</span>
        <span class="n">_lookup_table</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_create_table</span><span class="p">(</span><span class="n">_lookup_table</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="c1"># use the table directly to convert to Holonomic</span>
    <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="n">is_Function</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_1</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">_mytype</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x_1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_lookup_table</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">_lookup_table</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">change_x</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">_convert_meijerint</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sol</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="k">if</span> <span class="n">y0</span><span class="p">:</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span>
            <span class="k">if</span> <span class="n">y0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">initcond</span><span class="p">:</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span>
                <span class="k">return</span> <span class="n">sol</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">lenics</span><span class="p">:</span>
                <span class="n">lenics</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">order</span>
            <span class="n">_y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lenics</span><span class="p">)</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">_y0</span><span class="p">:</span>
                <span class="n">x0</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">_y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lenics</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">annihilator</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">_y0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">y0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">initcond</span><span class="p">:</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">composition</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">y0</span><span class="p">:</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span>
            <span class="n">sol</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span>
            <span class="k">return</span> <span class="n">sol</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lenics</span><span class="p">:</span>
            <span class="n">lenics</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">order</span>

        <span class="n">_y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lenics</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">_y0</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">_y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lenics</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sol</span><span class="o">.</span><span class="n">composition</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x0</span><span class="p">,</span> <span class="n">_y0</span><span class="p">)</span>

    <span class="c1"># iterate through the expression recursively</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">args</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">func</span>
    <span class="kn">from</span> <span class="nn">sympy.core</span> <span class="k">import</span> <span class="n">Add</span><span class="p">,</span> <span class="n">Mul</span><span class="p">,</span> <span class="n">Pow</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">expr_to_holonomic</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="n">Add</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
            <span class="n">sol</span> <span class="o">+=</span> <span class="n">expr_to_holonomic</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">f</span> <span class="ow">is</span> <span class="n">Mul</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
            <span class="n">sol</span> <span class="o">*=</span> <span class="n">expr_to_holonomic</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">f</span> <span class="ow">is</span> <span class="n">Pow</span><span class="p">:</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">sol</span><span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sol</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sol</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="k">if</span> <span class="n">y0</span><span class="p">:</span>
        <span class="n">sol</span><span class="o">.</span><span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span>
    <span class="k">if</span> <span class="n">y0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">initcond</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sol</span>
    <span class="k">if</span> <span class="n">sol</span><span class="o">.</span><span class="n">y0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sol</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">lenics</span><span class="p">:</span>
        <span class="n">lenics</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">order</span>
    <span class="k">if</span> <span class="n">sol</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="n">x0</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">_indicial</span><span class="p">()</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">r</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">func</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="n">r</span>
            <span class="n">singular_ics</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lenics</span><span class="p">)</span>
            <span class="n">singular_ics</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">singular_ics</span><span class="p">)]</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="p">{</span><span class="n">r</span><span class="p">:</span><span class="n">singular_ics</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">annihilator</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

    <span class="n">_y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lenics</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">_y0</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">_y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lenics</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">annihilator</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">_y0</span><span class="p">)</span></div>


<span class="c1">## Some helper functions ##</span>

<span class="k">def</span> <span class="nf">_normalize</span><span class="p">(</span><span class="n">list_of</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize a given annihilator</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">base</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">get_field</span><span class="p">()</span>
    <span class="n">lcm_denom</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">from_sympy</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">list_of_coeff</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># convert polynomials to the elements of associated</span>
    <span class="c1"># fraction field</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">list_of_coeff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">rep</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">list_of_coeff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">from_sympy</span><span class="p">(</span><span class="n">sympify</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_of_coeff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="c1"># corresponding numerators of the sequence of polynomials</span>
        <span class="n">num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_of_coeff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">numer</span><span class="p">())</span>

        <span class="c1"># corresponding denominators</span>
        <span class="n">denom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_of_coeff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">denom</span><span class="p">())</span>

    <span class="c1"># lcm of denominators in the coefficients</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">denom</span><span class="p">:</span>
        <span class="n">lcm_denom</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">lcm</span><span class="p">(</span><span class="n">lcm_denom</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">negative</span><span class="p">:</span>
        <span class="n">lcm_denom</span> <span class="o">=</span> <span class="o">-</span><span class="n">lcm_denom</span>

    <span class="n">lcm_denom</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">lcm_denom</span><span class="o">.</span><span class="n">rep</span><span class="p">)</span>

    <span class="c1"># multiply the coefficients with lcm</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_coeff</span><span class="p">):</span>
        <span class="n">list_of_coeff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span> <span class="o">*</span> <span class="n">lcm_denom</span>

    <span class="n">gcd_numer</span> <span class="o">=</span> <span class="n">base</span><span class="p">((</span><span class="n">list_of_coeff</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numer</span><span class="p">()</span> <span class="o">/</span> <span class="n">list_of_coeff</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">denom</span><span class="p">())</span><span class="o">.</span><span class="n">rep</span><span class="p">)</span>

    <span class="c1"># gcd of numerators in the coefficients</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num</span><span class="p">:</span>
        <span class="n">gcd_numer</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">gcd_numer</span><span class="p">)</span>

    <span class="n">gcd_numer</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">gcd_numer</span><span class="o">.</span><span class="n">rep</span><span class="p">)</span>

    <span class="c1"># divide all the coefficients by the gcd</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_coeff</span><span class="p">):</span>
        <span class="n">frac_ans</span> <span class="o">=</span> <span class="n">j</span> <span class="o">/</span> <span class="n">gcd_numer</span>
        <span class="n">list_of_coeff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span><span class="p">((</span><span class="n">frac_ans</span><span class="o">.</span><span class="n">numer</span><span class="p">()</span> <span class="o">/</span> <span class="n">frac_ans</span><span class="o">.</span><span class="n">denom</span><span class="p">())</span><span class="o">.</span><span class="n">rep</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">DifferentialOperator</span><span class="p">(</span><span class="n">list_of_coeff</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_derivate_diff_eq</span><span class="p">(</span><span class="n">listofpoly</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Let a differential equation a0(x)y(x) + a1(x)y&#39;(x) + ... = 0</span>
<span class="sd">    where a0, a1,... are polynomials or rational functions. The function</span>
<span class="sd">    returns b0, b1, b2... such that the differential equation</span>
<span class="sd">    b0(x)y(x) + b1(x)y&#39;(x) +... = 0 is formed after differentiating the</span>
<span class="sd">    former equation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">listofpoly</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DMFdiff</span><span class="p">(</span><span class="n">listofpoly</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">listofpoly</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DMFdiff</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">listofpoly</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listofpoly</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">sol</span>


<span class="k">def</span> <span class="nf">_hyper_to_meijerg</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a `hyper` to meijerg.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">ap</span>
    <span class="n">bq</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">bq</span>

    <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bq</span><span class="p">)</span>

    <span class="n">ispoly</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ispoly</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">hyperexpand</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># paramters of the `meijerg` function.</span>
    <span class="n">an</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ap</span><span class="p">)</span>
    <span class="n">anp</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">bm</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="p">)</span>
    <span class="n">bmq</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bq</span><span class="p">)</span>

    <span class="n">k</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bq</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ap</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">k</span> <span class="o">*</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">an</span><span class="p">,</span> <span class="n">anp</span><span class="p">,</span> <span class="n">bm</span><span class="p">,</span> <span class="n">bmq</span><span class="p">,</span> <span class="o">-</span><span class="n">z</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_add_lists</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="n">list2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Takes polynomial sequences of two annihilators a and b and returns</span>
<span class="sd">    the list of polynomials of sum of a and b.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list2</span><span class="p">):</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="n">list2</span><span class="p">)]</span> <span class="o">+</span> <span class="n">list2</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">list1</span><span class="p">):]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="n">list2</span><span class="p">)]</span> <span class="o">+</span> <span class="n">list1</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">list2</span><span class="p">):]</span>
    <span class="k">return</span> <span class="n">sol</span>


<span class="k">def</span> <span class="nf">_extend_y0</span><span class="p">(</span><span class="n">Holonomic</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tries to find more initial conditions by substituting the initial</span>
<span class="sd">    value point in the differential equation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">Holonomic</span><span class="o">.</span><span class="n">annihilator</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="n">Holonomic</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Holonomic</span><span class="o">.</span><span class="n">is_singularics</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Holonomic</span><span class="o">.</span><span class="n">y0</span>

    <span class="n">annihilator</span> <span class="o">=</span> <span class="n">Holonomic</span><span class="o">.</span><span class="n">annihilator</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">annihilator</span><span class="o">.</span><span class="n">order</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Holonomic</span><span class="o">.</span><span class="n">x</span>

    <span class="n">listofpoly</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">y0</span> <span class="o">=</span> <span class="n">Holonomic</span><span class="o">.</span><span class="n">y0</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">get_field</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">annihilator</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">annihilator</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
                <span class="n">listofpoly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">rep</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y0</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">y0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">list_red</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">listofpoly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">listofpoly</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">:</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span>  <span class="ow">in</span> <span class="n">y0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">a</span><span class="p">):</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">list_red</span><span class="p">):</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">DMFsubs</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">Holonomic</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">is_finite</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">y0</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">PolyElement</span><span class="p">,</span> <span class="n">FracElement</span><span class="p">)):</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
                <span class="n">sol</span> <span class="o">+=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">r</span>
            <span class="n">y1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
            <span class="n">list_red</span> <span class="o">=</span> <span class="n">_derivate_diff_eq</span><span class="p">(</span><span class="n">list_red</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">y1</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">y0</span><span class="p">):]</span>


<span class="k">def</span> <span class="nf">DMFdiff</span><span class="p">(</span><span class="n">frac</span><span class="p">):</span>
    <span class="c1"># differentiate a DMF object represented as p/q</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span> <span class="n">DMF</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">frac</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>

    <span class="n">K</span> <span class="o">=</span> <span class="n">frac</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">numer</span><span class="p">(</span><span class="n">frac</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">denom</span><span class="p">(</span><span class="n">frac</span><span class="p">)</span>
    <span class="n">sol_num</span> <span class="o">=</span> <span class="o">-</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
    <span class="n">sol_denom</span> <span class="o">=</span> <span class="n">q</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">K</span><span class="p">((</span><span class="n">sol_num</span><span class="o">.</span><span class="n">rep</span><span class="p">,</span> <span class="n">sol_denom</span><span class="o">.</span><span class="n">rep</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">DMFsubs</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">mpm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># substitute the point x0 in DMF object of the form p/q</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span> <span class="n">DMF</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">frac</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">frac</span><span class="o">.</span><span class="n">num</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">frac</span><span class="o">.</span><span class="n">den</span>
    <span class="n">sol_p</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sol_q</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mpm</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">mpmath</span> <span class="k">import</span> <span class="n">mp</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">mpm</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">_to_mpmath</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">prec</span><span class="p">)</span>
        <span class="n">sol_p</span> <span class="o">+=</span> <span class="n">j</span> <span class="o">*</span> <span class="n">x0</span><span class="o">**</span><span class="n">i</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">q</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">mpm</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">_to_mpmath</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">prec</span><span class="p">)</span>
        <span class="n">sol_q</span> <span class="o">+=</span> <span class="n">j</span> <span class="o">*</span> <span class="n">x0</span><span class="o">**</span><span class="n">i</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sol_p</span><span class="p">,</span> <span class="p">(</span><span class="n">PolyElement</span><span class="p">,</span> <span class="n">FracElement</span><span class="p">)):</span>
        <span class="n">sol_p</span> <span class="o">=</span> <span class="n">sol_p</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sol_q</span><span class="p">,</span> <span class="p">(</span><span class="n">PolyElement</span><span class="p">,</span> <span class="n">FracElement</span><span class="p">)):</span>
        <span class="n">sol_q</span> <span class="o">=</span> <span class="n">sol_q</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">sol_p</span> <span class="o">/</span> <span class="n">sol_q</span>


<span class="k">def</span> <span class="nf">_convert_poly_rat_alg</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lenics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">QQ</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts polynomials, rationals and algebraic functions to holonomic.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ispoly</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">is_polynomial</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ispoly</span><span class="p">:</span>
        <span class="n">israt</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">is_rational_function</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">israt</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ispoly</span> <span class="ow">or</span> <span class="n">israt</span><span class="p">):</span>
        <span class="n">basepoly</span><span class="p">,</span> <span class="n">ratexp</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">as_base_exp</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">basepoly</span><span class="o">.</span><span class="n">is_polynomial</span><span class="p">()</span> <span class="ow">and</span> <span class="n">ratexp</span><span class="o">.</span><span class="n">is_Number</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ratexp</span><span class="p">,</span> <span class="n">Float</span><span class="p">):</span>
                <span class="n">ratexp</span> <span class="o">=</span> <span class="n">nsimplify</span><span class="p">(</span><span class="n">ratexp</span><span class="p">)</span>
            <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">ratexp</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">ratexp</span><span class="o">.</span><span class="n">q</span>
            <span class="n">is_alg</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_alg</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_alg</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ispoly</span> <span class="ow">or</span> <span class="n">israt</span> <span class="ow">or</span> <span class="n">is_alg</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">old_poly_ring</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">Dx</span> <span class="o">=</span> <span class="n">DifferentialOperators</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="s1">&#39;Dx&#39;</span><span class="p">)</span>

    <span class="c1"># if the function is constant</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">func</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">Dx</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">func</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">ispoly</span><span class="p">:</span>
        <span class="c1"># differential equation satisfied by polynomial</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">func</span> <span class="o">*</span> <span class="n">Dx</span> <span class="o">-</span> <span class="n">func</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">_normalize</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">is_singular</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>

        <span class="c1"># try to compute the conditions for singular points</span>
        <span class="k">if</span> <span class="n">y0</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">x0</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">is_singular</span><span class="p">:</span>
            <span class="n">rep</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">from_sympy</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">rep</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">rep</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">coeff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">rep</span><span class="p">))[</span><span class="n">i</span><span class="p">:]</span>
                    <span class="n">indicial</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coeff</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">PolyElement</span><span class="p">,</span> <span class="n">FracElement</span><span class="p">)):</span>
                    <span class="n">coeff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="p">{</span><span class="n">indicial</span><span class="p">:</span> <span class="n">S</span><span class="p">(</span><span class="n">coeff</span><span class="p">)}</span>

    <span class="k">elif</span> <span class="n">israt</span><span class="p">:</span>
        <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">as_numer_denom</span><span class="p">()</span>
        <span class="c1"># differential equation satisfied by rational</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">Dx</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">_normalize</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">listofpoly</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">is_alg</span><span class="p">:</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dx</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">composition</span><span class="p">(</span><span class="n">basepoly</span><span class="p">)</span><span class="o">.</span><span class="n">annihilator</span>
        <span class="n">is_singular</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>

        <span class="c1"># try to compute the conditions for singular points</span>
        <span class="k">if</span> <span class="n">y0</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">x0</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">is_singular</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">lenics</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lenics</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">rep</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">from_sympy</span><span class="p">(</span><span class="n">basepoly</span><span class="p">)</span><span class="o">.</span><span class="n">rep</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">rep</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">PolyElement</span><span class="p">,</span> <span class="n">FracElement</span><span class="p">)):</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>

                <span class="n">coeff</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">**</span><span class="n">ratexp</span>
                <span class="n">indicial</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">ratexp</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="p">(</span><span class="n">PolyElement</span><span class="p">,</span> <span class="n">FracElement</span><span class="p">)):</span>
                <span class="n">coeff</span> <span class="o">=</span> <span class="n">coeff</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="p">{</span><span class="n">indicial</span><span class="p">:</span> <span class="n">S</span><span class="p">([</span><span class="n">coeff</span><span class="p">])}</span>

    <span class="k">if</span> <span class="n">y0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">initcond</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">lenics</span><span class="p">:</span>
        <span class="n">lenics</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">order</span>

    <span class="k">if</span> <span class="n">sol</span><span class="o">.</span><span class="n">is_singular</span><span class="p">(</span><span class="n">x0</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">_indicial</span><span class="p">()</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">r</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">func</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="n">r</span>
            <span class="n">singular_ics</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lenics</span><span class="p">)</span>
            <span class="n">singular_ics</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">singular_ics</span><span class="p">)]</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="p">{</span><span class="n">r</span><span class="p">:</span><span class="n">singular_ics</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>

    <span class="n">y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lenics</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">y0</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">_find_conditions</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lenics</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_convert_meijerint</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">QQ</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">meijerint</span><span class="o">.</span><span class="n">_rewrite1</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># lists for sum of meijerg functions</span>
    <span class="n">fac_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">fac</span> <span class="o">*</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">as_base_exp</span><span class="p">()</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">x</span> <span class="k">else</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">po_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g</span><span class="p">]</span>
    <span class="n">G_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g</span><span class="p">]</span>

    <span class="c1"># finds meijerg representation of x**s * meijerg(a1 ... ap, b1 ... bq, z)</span>
    <span class="k">def</span> <span class="nf">_shift</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">z</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">I</span><span class="p">):</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">exp_polar</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">as_base_exp</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">x</span> <span class="k">else</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="n">b</span>
        <span class="n">an</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">r</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">r</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">bm</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">r</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">bq</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">r</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">a</span><span class="o">**-</span><span class="n">r</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">((</span><span class="n">an</span><span class="p">,</span> <span class="n">ap</span><span class="p">),</span> <span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">bq</span><span class="p">),</span> <span class="n">z</span><span class="p">)</span>

    <span class="n">coeff</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">_shift</span><span class="p">(</span><span class="n">G_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">po_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">fac_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">from_meijerg</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="n">initcond</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="c1"># add all the meijerg functions after converting to holonomic</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_list</span><span class="p">)):</span>
        <span class="n">coeff</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">_shift</span><span class="p">(</span><span class="n">G_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">po_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">sol</span> <span class="o">+=</span> <span class="n">fac_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">from_meijerg</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">initcond</span><span class="o">=</span><span class="n">initcond</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sol</span>


<span class="k">def</span> <span class="nf">_create_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">QQ</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates the look-up table. For a similar implementation</span>
<span class="sd">    see meijerint._create_lookup_table.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">annihilator</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a formula in the dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">_mytype</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">x_1</span><span class="p">),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">formula</span><span class="p">,</span>
            <span class="n">HolonomicFunction</span><span class="p">(</span><span class="n">annihilator</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)))</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">old_poly_ring</span><span class="p">(</span><span class="n">x_1</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">Dx</span> <span class="o">=</span> <span class="n">DifferentialOperators</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="s1">&#39;Dx&#39;</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">erf</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span>
        <span class="n">sinh</span><span class="p">,</span> <span class="n">cosh</span><span class="p">,</span> <span class="n">sinc</span><span class="p">,</span> <span class="n">erfc</span><span class="p">,</span> <span class="n">Si</span><span class="p">,</span> <span class="n">Ci</span><span class="p">,</span> <span class="n">Shi</span><span class="p">,</span> <span class="n">erfi</span><span class="p">)</span>

    <span class="c1"># add some basic functions</span>
    <span class="n">add</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="n">Dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">add</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="n">Dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">add</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="n">Dx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="n">Dx</span> <span class="o">+</span> <span class="n">x_1</span><span class="o">*</span><span class="n">Dx</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x_1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="n">add</span><span class="p">(</span><span class="n">erf</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="mi">2</span><span class="o">*</span><span class="n">x_1</span><span class="o">*</span><span class="n">Dx</span> <span class="o">+</span> <span class="n">Dx</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">)])</span>
    <span class="n">add</span><span class="p">(</span><span class="n">erfc</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="mi">2</span><span class="o">*</span><span class="n">x_1</span><span class="o">*</span><span class="n">Dx</span> <span class="o">+</span> <span class="n">Dx</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">)])</span>
    <span class="n">add</span><span class="p">(</span><span class="n">erfi</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">x_1</span><span class="o">*</span><span class="n">Dx</span> <span class="o">+</span> <span class="n">Dx</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">)])</span>

    <span class="n">add</span><span class="p">(</span><span class="n">sinh</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="n">Dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">add</span><span class="p">(</span><span class="n">cosh</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="n">Dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="n">add</span><span class="p">(</span><span class="n">sinc</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="n">x_1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">Dx</span> <span class="o">+</span> <span class="n">x_1</span><span class="o">*</span><span class="n">Dx</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x_1</span><span class="p">)</span>

    <span class="n">add</span><span class="p">(</span><span class="n">Si</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="n">x_1</span><span class="o">*</span><span class="n">Dx</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">Dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x_1</span><span class="o">*</span><span class="n">Dx</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">x_1</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="n">Ci</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="n">x_1</span><span class="o">*</span><span class="n">Dx</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">Dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x_1</span><span class="o">*</span><span class="n">Dx</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">x_1</span><span class="p">)</span>

    <span class="n">add</span><span class="p">(</span><span class="n">Shi</span><span class="p">(</span><span class="n">x_1</span><span class="p">),</span> <span class="o">-</span><span class="n">x_1</span><span class="o">*</span><span class="n">Dx</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">Dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x_1</span><span class="o">*</span><span class="n">Dx</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">x_1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_find_conditions</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">NaN</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">limit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">is_finite</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">val</span><span class="o">.</span><span class="n">is_finite</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">NaN</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">y0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y0</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/sympylogo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SymPy 1.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017 SymPy Development Team.
      Last updated on Jul 27, 2017.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>